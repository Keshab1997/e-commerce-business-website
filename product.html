<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</title>
    <link rel="stylesheet" href="./styles/variables.css">
    <link rel="stylesheet" href="./styles/main.css">
    <link rel="stylesheet" href="./modules/client/product-view/view.css">
</head>
<body>
    <div class="product-view-container">
        <a href="shop.html" class="btn-back">‚¨Ö ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</a>
        <div class="product-details-grid">
            <div class="image-section"><img id="view-img" src=""></div>
            <div class="info-section">
                <h1 id="view-name">...</h1>
                <p id="view-category">...</p>
                <div class="price-tag">‚Çπ <span id="view-price">0</span></div>
                <p id="view-desc">...</p>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="orderNow()">üõí ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button class="btn btn-whatsapp" onclick="orderOnWhatsApp()">WhatsApp Order</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ -->
    <div id="order-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <form id="order-form">
                <input type="text" id="cust-name" placeholder="‡¶®‡¶æ‡¶Æ" required>
                <input type="text" id="cust-phone" placeholder="‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" required>
                <textarea id="cust-address" placeholder="‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ" required></textarea>
                <button type="submit" class="btn btn-primary btn-block">‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
        </div>
    </div>

    <script type="module">
        import { db } from './config/firebase-config.js';
        import { doc, getDoc, addDoc, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        let currentProduct = {};

        async function loadProduct() {
            if (!productId) return;
            const docRef = doc(db, "products", productId);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                const p = docSnap.data();
                currentProduct = { id: docSnap.id, ...p };
                document.getElementById('view-img').src = p.image;
                document.getElementById('view-name').innerText = p.name;
                document.getElementById('view-price').innerText = p.price;
                document.getElementById('view-category').innerText = p.category;
                document.getElementById('view-desc').innerText = p.description;
            }
        }
        loadProduct();

        // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.orderNow = () => document.getElementById('order-modal').style.display = 'flex';
        window.closeModal = () => document.getElementById('order-modal').style.display = 'none';
        
        window.orderOnWhatsApp = () => {
            const phone = "919876543210"; // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞
            const msg = `Order: ${currentProduct.name}, Price: ‚Çπ${currentProduct.price}`;
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');
        };

        document.getElementById('order-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await addDoc(collection(db, "orders"), {
                    customerName: document.getElementById('cust-name').value,
                    phone: document.getElementById('cust-phone').value,
                    address: document.getElementById('cust-address').value,
                    productName: currentProduct.name,
                    price: currentProduct.price,
                    status: 'pending',
                    orderDate: new Date()
                });
                alert("‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                closeModal();
            } catch (err) { alert("‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá"); }
        });
    </script>
</body>
</html>