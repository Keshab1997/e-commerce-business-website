<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</title>
    <link rel="stylesheet" href="./styles/variables.css">
    <link rel="stylesheet" href="./styles/main.css">
    <link rel="stylesheet" href="./modules/client/product-view/view.css">
</head>
<body>
    <div class="product-view-container">
        <a href="shop.html" class="btn-back">‚¨Ö ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</a>

        <div class="product-details-grid">
            <div class="image-section">
                <div class="main-image-box">
                    <img id="view-img" src="" alt="Product Image">
                </div>
            </div>

            <div class="info-section">
                <h1 id="view-name" class="product-title">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</h1>
                <p class="product-category" id="view-category">...</p>
                
                <!-- üëá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‚Çπ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá -->
                <div class="price-tag">
                    ‚Çπ <span id="view-price">0</span>
                </div>

                <div class="description-box">
                    <h3>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£:</h3>
                    <p id="view-desc">...</p>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary btn-lg" onclick="orderNow()">üõí ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button class="btn btn-whatsapp" onclick="orderOnWhatsApp()">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="20"> 
                        ‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞
                    </button>
                </div>

                <div class="delivery-info">
                    <p>üöö ‡¶∏‡¶æ‡¶∞‡¶æ ‡¶≠‡¶æ‡¶∞‡¶§‡ßá ‡¶π‡ßã‡¶Æ ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø</p>
                    <p>üîÑ ‡ß≠ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡¶™‡¶≤‡¶ø‡¶∏‡¶ø</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ -->
    <div id="order-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <form id="order-form">
                <input type="text" id="cust-name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" required>
                <input type="text" id="cust-phone" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" required>
                <textarea id="cust-address" placeholder="‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ" required></textarea>
                <button type="submit" class="btn btn-primary btn-block">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
        </div>
    </div>

    <script type="module">
        import { db } from './config/firebase-config.js';
        import { doc, getDoc, addDoc, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        let currentProduct = {};

        async function loadProduct() {
            if (!productId) return;
            const docRef = doc(db, "products", productId);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const p = docSnap.data();
                currentProduct = { id: docSnap.id, ...p };

                document.getElementById('view-img').src = p.image;
                document.getElementById('view-name').innerText = p.name;
                document.getElementById('view-price').innerText = p.price; // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¨‡¶∏‡¶¨‡ßá, ‡¶∏‡¶æ‡¶Æ‡¶®‡ßá ‚Çπ ‡¶Ü‡¶õ‡ßá
                document.getElementById('view-category').innerText = p.category;
                document.getElementById('view-desc').innerText = p.description || "‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶®‡ßá‡¶á‡•§";
            }
        }
        loadProduct();

        window.orderNow = () => {
            document.getElementById('order-modal').style.display = 'flex';
        };

        window.closeModal = () => {
            document.getElementById('order-modal').style.display = 'none';
        };

        window.orderOnWhatsApp = () => {
            // üëá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶°‡¶ø‡¶Ø‡¶º‡¶æ‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶® (91 ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ)
            const phoneNumber = "919876543210"; 
            
            // üëá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡ßá ‡¶∞‡ßÅ‡¶™‡¶ø ‡¶ö‡¶ø‡¶π‡ßç‡¶®
            const message = `‡¶π‡¶æ‡¶á! ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶á ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü‡¶ü‡¶ø ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶ö‡¶æ‡¶á:
            
‡¶®‡¶æ‡¶Æ: ${currentProduct.name}
‡¶¶‡¶æ‡¶Æ: ‚Çπ${currentProduct.price}
‡¶≤‡¶ø‡¶ô‡ßç‡¶ï: ${window.location.href}`;

            const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        };

        document.getElementById('order-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.innerText = "‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            btn.disabled = true;

            const orderData = {
                customerName: document.getElementById('cust-name').value,
                phone: document.getElementById('cust-phone').value,
                address: document.getElementById('cust-address').value,
                productName: currentProduct.name,
                price: currentProduct.price,
                productId: currentProduct.id,
                status: 'pending',
                orderDate: new Date()
            };

            try {
                await addDoc(collection(db, "orders"), orderData);
                alert("‚úÖ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                closeModal();
                e.target.reset();
            } catch (error) {
                alert("‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
            } finally {
                btn.innerText = "‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®";
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>