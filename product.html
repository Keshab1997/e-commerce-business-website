<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ | ‡¶∂‡¶æ‡¶°‡¶º‡¶ø ‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶∞</title>
    
    <!-- ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶∂‡¶ø‡¶ü -->
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="modules/common/navbar/navbar.css">
    <link rel="stylesheet" href="modules/common/footer/footer.css">
    <link rel="stylesheet" href="modules/client/product-view/view.css">
</head>
<body>

    <!-- ‡ßß. ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶∞ -->
    <nav class="navbar">
        <div class="nav-container">
            <!-- ‡¶≤‡ßã‡¶ó‡ßã -->
            <a href="index.html" class="nav-logo" id="dynamic-nav-logo">Loading...</a>
            
            <!-- ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ -->
            <ul class="nav-menu">
                <li>
                    <a href="index.html" class="nav-link">üè† Home</a>
                </li>
                <li>
                    <a href="shop.html" class="nav-link">üõçÔ∏è Collection</a>
                </li>
                
                <!-- ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶Ü‡¶á‡¶ï‡¶® -->
                <li>
                    <a href="cart.html" class="nav-link cart-link">
                        üõí Cart <span class="cart-count">0</span>
                    </a>
                </li>

                <!-- ‡¶≤‡¶ó‡¶á‡¶® / ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ (‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï) -->
                <li id="auth-menu">
                    <button onclick="googleLogin()" class="btn-login">üîë Login</button>
                </li>
            </ul>
        </div>
    </nav>

    <!-- ‡ß®. ‡¶Æ‡ßá‡¶á‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü -->
    <div class="product-view-container">
        
        <!-- ‡¶¨‡ßç‡¶∞‡ßá‡¶°‡¶ï‡ßç‡¶∞‡¶æ‡¶Æ‡ßç‡¶¨ / ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡¶æ‡¶ü‡¶® -->
        <div class="breadcrumb">
            <a href="shop.html" class="btn-back">‚¨Ö ‡¶ï‡¶æ‡¶≤‡ßá‡¶ï‡¶∂‡¶®‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</a>
        </div>

        <div class="product-details-grid">
            <!-- ‡¶¨‡¶æ‡¶Æ ‡¶™‡¶æ‡¶∂: ‡¶õ‡¶¨‡¶ø -->
            <div class="image-section">
                <!-- ‡¶Æ‡ßá‡¶á‡¶® ‡¶≠‡¶ø‡¶â -->
                <div class="main-image-box">
                    <!-- ‡¶õ‡¶¨‡¶ø -->
                    <img id="view-img" src="" alt="Product Image">
                    
                    <!-- ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì (‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶•‡¶æ‡¶ï‡¶¨‡ßá) -->
                    <iframe id="view-video" 
                        src="" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen
                        style="display:none; width:100%; height:100%;">
                    </iframe>
                </div>

                <!-- ‡¶•‡¶æ‡¶Æ‡ßç‡¶¨‡¶®‡ßá‡¶á‡¶≤ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø -->
                <div class="thumbnail-gallery" id="thumb-container">
                    <!-- ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá -->
                </div>
            </div>

            <!-- ‡¶°‡¶æ‡¶® ‡¶™‡¶æ‡¶∂: ‡¶§‡¶•‡ßç‡¶Ø -->
            <div class="info-section">
                <p class="product-category" id="view-category">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</p>
                <h1 id="view-name" class="product-title">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</h1>
                
                <div class="price-tag">
                    <span class="currency">‚Çπ</span> <span id="view-price">0</span>
                </div>

                <!-- üëá ‡¶®‡¶§‡ßÅ‡¶®: ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶∏‡ßç‡¶™‡ßá‡¶∏‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ -->
                <div class="specs-box" style="background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:20px;">
                    <p><strong>üé® ‡¶∞‡¶ô:</strong> <span id="view-color">...</span></p>
                    <p><strong><span id="material-label">üßµ ‡¶ï‡¶æ‡¶™‡¶°‡¶º</span>:</strong> <span id="view-material">...</span></p>
                    <p><strong>üìè ‡¶∏‡¶æ‡¶á‡¶ú:</strong> <span id="view-size">...</span></p>
                </div>

                <div class="divider"></div>

                <div class="description-box">
                    <h3>‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£:</h3>
                    <p id="view-desc">...</p>
                </div>

                <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶¨‡¶æ‡¶ü‡¶® -->
                <div class="action-buttons">
                    <button class="btn btn-primary btn-lg" onclick="addToCartBtn()">
                        üõí ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                    <button class="btn btn-whatsapp btn-lg" onclick="orderOnWhatsApp()">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="24"> 
                        WhatsApp Order
                    </button>
                </div>

                <!-- ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶§‡¶•‡ßç‡¶Ø -->
                <div class="features-list">
                    <div class="feat-item">üöö ‡¶∏‡¶æ‡¶∞‡¶æ ‡¶≠‡¶æ‡¶∞‡¶§‡ßá ‡¶´‡ßç‡¶∞‡¶ø ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø</div>
                    <div class="feat-item">üíé ‡ßß‡ß¶‡ß¶% ‡¶Ö‡¶∞‡¶ø‡¶ú‡¶ø‡¶®‡¶æ‡¶≤ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü</div>
                    <div class="feat-item">üîÑ ‡ß≠ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶π‡¶ú ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶®</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-col brand-col">
                <h2 id="f-name" class="footer-logo">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</h2>
                <p id="f-desc" class="footer-desc">...</p>
                <div class="social-icons">
                    <a href="#" id="f-fb" target="_blank" class="social-btn fb">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="FB">
                    </a>
                    <a href="#" id="f-insta" target="_blank" class="social-btn insta">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Insta">
                    </a>
                    <a href="#" id="f-wa" target="_blank" class="social-btn wa">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WA">
                    </a>
                </div>
            </div>
            <div class="footer-col">
                <h4>‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï</h4>
                <ul class="footer-links">
                    <li><a href="index.html">‡¶π‡ßã‡¶Æ</a></li>
                    <li><a href="shop.html">‡¶ï‡¶æ‡¶≤‡ßá‡¶ï‡¶∂‡¶®</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                <div class="contact-info">
                    <p id="f-phone">üìû ...</p>
                    <p id="f-email">‚úâÔ∏è ...</p>
                    <p id="f-address">üìç ...</p>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; <span id="year">2025</span> <span id="f-copyright-name">SootBoot</span> | ‡¶∏‡¶∞‡ßç‡¶¨‡¶∏‡ßç‡¶¨‡¶§‡ßç‡¶¨ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§</p>
        </div>
    </footer>

    <!-- ‡ß™. ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ -->
    <div id="order-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            
            <div class="modal-header">
                <h2>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <p>‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶® ‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶™‡ßå‡¶Å‡¶õ‡ßá ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø</p>
            </div>

            <form id="order-form">
                <div class="form-group">
                    <label>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                    <input type="text" id="cust-name" placeholder="‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" required>
                </div>

                <div class="form-group">
                    <label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                    <input type="tel" id="cust-phone" placeholder="‡ßß‡ß¶ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" pattern="[0-9]{10}" required>
                </div>

                <div class="form-group">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label>‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label>
                        <button type="button" onclick="getLocation()" class="btn-location">
                            üìç ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶®‡¶ø‡¶®
                        </button>
                    </div>
                    <textarea id="cust-address" rows="3" placeholder="‡¶¨‡¶æ‡¶∏‡¶æ‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞, ‡¶∞‡¶æ‡¶∏‡ßç‡¶§‡¶æ, ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ, ‡¶™‡¶ø‡¶® ‡¶ï‡ßã‡¶°..." required></textarea>
                    <p id="loc-status" style="font-size:0.8rem; color:green; margin-top:5px;"></p>
                </div>

                <div class="payment-option">
                    <label><input type="radio" checked> ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Ö‡¶® ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø (COD)</label>
                </div>

                <button type="submit" class="btn btn-primary btn-block">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
        </div>
    </div>

    <!-- ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü -->
    <script type="module">
        import { db, auth, loginWithGoogle } from './config/firebase-config.js';
        import { doc, getDoc, addDoc, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { loadShopBranding } from './utils/global-loader.js'; // ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ ‡¶≤‡ßã‡¶°‡¶æ‡¶∞
        import { addToCart, updateCartCount } from './utils/cart.js';

        // ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
        loadShopBranding();

        // ‡¶≤‡¶ó‡¶á‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï
        window.googleLogin = async () => {
            try { await loginWithGoogle(); } catch (e) { console.log(e); }
        };

        // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï
        onAuthStateChanged(auth, (user) => {
            const menu = document.getElementById('auth-menu');
            if (user) {
                menu.innerHTML = `<a href="profile.html" class="nav-link">üë§ Profile</a>`;
                if(user.email === "keshabsarkar2018@gmail.com") {
                    menu.innerHTML += ` <a href="dashboard.html" class="nav-link" style="color:gold;">üîí Dashboard</a>`;
                }
            } else {
                menu.innerHTML = `<button onclick="googleLogin()" class="btn-login">üîë Login</button>`;
            }
        });

        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        let currentProduct = {};

        async function loadProduct() {
            if (!productId) return;
            const docRef = doc(db, "products", productId);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                const p = docSnap.data();
                currentProduct = { id: docSnap.id, ...p };
                
                document.getElementById('view-img').src = p.image;
                document.getElementById('view-name').innerText = p.name;
                document.getElementById('view-price').innerText = p.price;
                document.getElementById('view-category').innerText = p.category;
                document.getElementById('view-desc').innerText = p.description || "‡¶ñ‡ßÅ‡¶¨‡¶á ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶Æ‡¶æ‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶™‡¶°‡¶º ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶ß‡ßÅ‡¶®‡¶ø‡¶ï ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®‡•§";

                // ‡¶•‡¶æ‡¶Æ‡ßç‡¶¨‡¶®‡ßá‡¶á‡¶≤ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞
                const thumbContainer = document.getElementById('thumb-container');
                thumbContainer.innerHTML = '';

                // ‡ßß. ‡¶õ‡¶¨‡¶ø‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
                if (p.images && p.images.length > 0) {
                    p.images.forEach(imgUrl => {
                        thumbContainer.innerHTML += `
                            <img src="${imgUrl}" class="thumb-img" onclick="changeView('image', '${imgUrl}')">
                        `;
                    });
                }

                // ‡ß®. ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
                if (p.video) {
                    const videoId = getYouTubeID(p.video);
                    
                    if (videoId) {
                        const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=0`;
                        
                        // ‡¶•‡¶æ‡¶Æ‡ßç‡¶¨‡¶®‡ßá‡¶á‡¶≤ ‡¶á‡¶Æ‡ßá‡¶ú (High Quality)
                        const thumbUrl = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;

                        thumbContainer.innerHTML += `
                            <div class="thumb-video" onclick="changeView('video', '${embedUrl}')">
                                <img src="${thumbUrl}" alt="Video Thumbnail">
                                <span class="play-icon">‚ñ∂</span>
                            </div>
                        `;
                    } else {
                        console.log("Invalid YouTube URL:", p.video);
                    }
                }

                // ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡¶∏‡¶æ‡¶®‡ßã
                document.getElementById('view-color').innerText = p.color || "N/A";
                document.getElementById('view-material').innerText = p.material || "N/A";
                document.getElementById('view-size').innerText = p.size || "Free Size";

                // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶≤‡ßá‡¶¨‡ßá‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® (‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï)
                const materialLabel = document.getElementById('material-label');
                
                if (p.category === 'jewelry') {
                    // ‡¶ó‡¶Ø‡¶º‡¶®‡¶æ ‡¶π‡¶≤‡ßá
                    materialLabel.innerHTML = '‚öñÔ∏è ‡¶ì‡¶ú‡¶®/‡¶ß‡¶æ‡¶§‡ßÅ'; 
                } else {
                    // ‡¶∂‡¶æ‡¶°‡¶º‡¶ø ‡¶¨‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶π‡¶≤‡ßá
                    materialLabel.innerHTML = 'üßµ ‡¶ï‡¶æ‡¶™‡¶°‡¶º';
                }
            }
        }
        loadProduct();

        // ‡ß©. ‡¶≠‡¶ø‡¶â ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.changeView = (type, url) => {
            const mainImg = document.getElementById('view-img');
            const mainVideo = document.getElementById('view-video');

            if (type === 'image') {
                mainImg.style.display = 'block';
                mainVideo.style.display = 'none';
                mainImg.src = url;
                mainVideo.src = ""; // ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
            } else {
                mainImg.style.display = 'none';
                mainVideo.style.display = 'block';
                mainVideo.src = url; // ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ
            }
        };

        // ‡ß™. ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶∏‡¶¨ ‡¶ß‡¶∞‡¶®‡ßá‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
        function getYouTubeID(url) {
            if (!url) return null;
            
            // ‡¶∏‡¶¨ ‡¶ß‡¶∞‡¶®‡ßá‡¶∞ ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∞‡ßç‡¶®
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            
            // ‡¶Ü‡¶á‡¶°‡¶ø ‡ßß‡ßß ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ï‡ßç‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶π‡¶Ø‡¶º
            return (match && match[7].length === 11) ? match[7] : null;
        }

        window.addToCartBtn = () => {
            const productToAdd = {
                id: currentProduct.id,
                name: currentProduct.name,
                price: currentProduct.price,
                image: currentProduct.image,
                color: document.getElementById('view-color').innerText,
                size: document.getElementById('view-size').innerText
            };
            addToCart(productToAdd);
        };

        window.orderNow = () => document.getElementById('order-modal').style.display = 'flex';
        window.closeModal = () => document.getElementById('order-modal').style.display = 'none';
        
        // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.getLocation = () => {
            const status = document.getElementById('loc-status');
            const addressBox = document.getElementById('cust-address');

            if (!navigator.geolocation) {
                status.innerText = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§";
                status.style.color = "red";
                return;
            }

            status.innerText = "‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            status.style.color = "blue";

            navigator.geolocation.getCurrentPosition(async (position) => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;

                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                    const data = await response.json();
                    
                    if (data && data.display_name) {
                        addressBox.value = data.display_name;
                        status.innerText = "‚úÖ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá!";
                        status.style.color = "green";
                    } else {
                        throw new Error("Address not found");
                    }
                } catch (error) {
                    status.innerText = "‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø, ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
                    status.style.color = "red";
                }
            }, () => {
                status.innerText = "‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§";
                status.style.color = "red";
            });
        };
        
        window.orderOnWhatsApp = () => {
            const phone = "919876543210"; 
            const msg = `Hi, I want to order: ${currentProduct.name}, Price: ‚Çπ${currentProduct.price}`;
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');
        };

        document.getElementById('order-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.innerText = "‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            btn.disabled = true;
            
            try {
                await addDoc(collection(db, "orders"), {
                    customerName: document.getElementById('cust-name').value,
                    phone: document.getElementById('cust-phone').value,
                    address: document.getElementById('cust-address').value,
                    
                    // ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶á‡¶®‡¶´‡ßã
                    productName: currentProduct.name,
                    price: currentProduct.price,
                    productId: currentProduct.id,
                    productImage: currentProduct.image, // ‡¶õ‡¶¨‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                    
                    status: 'pending',
                    orderDate: new Date()
                });
                alert("‚úÖ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶¨‡•§");
                closeModal();
                e.target.reset();
            } catch (err) { 
                alert("‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá"); 
            } finally {
                btn.innerText = "‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®";
                btn.disabled = false;
            }
        });
    </script>

    <!-- ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ -->
    <script type="module" src="./utils/global-loader.js"></script>
</body>
</html>