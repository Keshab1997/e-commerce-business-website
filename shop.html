<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶ï‡¶æ‡¶≤‡ßá‡¶ï‡¶∂‡¶® | ‡¶∂‡¶æ‡¶°‡¶º‡¶ø ‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶∞</title>
    <link rel="stylesheet" href="./styles/variables.css">
    <link rel="stylesheet" href="./styles/main.css">
    <link rel="stylesheet" href="./modules/common/navbar/navbar.css">
    <link rel="stylesheet" href="./modules/client/collections/gallery.css">
</head>
<body>
    <!-- ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">‡¶∂‡¶æ‡¶°‡¶º‡¶ø<span class="highlight">‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶∞</span></a>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">‡¶π‡ßã‡¶Æ</a></li>
                <li><a href="shop.html" class="nav-link">‡¶ï‡¶æ‡¶≤‡ßá‡¶ï‡¶∂‡¶®</a></li>
                <li><a href="admin.html" class="nav-link">üîí ‡¶è‡¶°‡¶Æ‡¶ø‡¶®</a></li>
            </ul>
        </div>
    </nav>

    <!-- ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø -->
    <div class="gallery-container">
        <h2 style="text-align:center; margin:40px 0; color:var(--primary-color);">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ï‡¶æ‡¶≤‡ßá‡¶ï‡¶∂‡¶®</h2>
        
        <!-- ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ -->
        <div class="filter-bar">
            <button class="filter-btn active" onclick="filterProducts('all')">‡¶∏‡¶¨</button>
            <button class="filter-btn" onclick="filterProducts('saree')">‡¶∂‡¶æ‡¶°‡¶º‡¶ø</button>
            <button class="filter-btn" onclick="filterProducts('suit')">‡¶∏‡ßÅ‡¶ü</button>
            <button class="filter-btn" onclick="filterProducts('jewelry')">‡¶ó‡¶Ø‡¶º‡¶®‡¶æ</button>
        </div>

        <!-- ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶ø‡¶° -->
        <div id="gallery-grid" class="product-grid">
            <div class="loading-spinner">‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        </div>
    </div>

    <script type="module">
        import { db } from './config/firebase-config.js';
        import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        let allProducts = [];

        async function loadProducts() {
            const grid = document.getElementById('gallery-grid');
            try {
                const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                
                allProducts = [];
                querySnapshot.forEach((doc) => {
                    allProducts.push({ id: doc.id, ...doc.data() });
                });

                renderProducts(allProducts);
            } catch (error) {
                grid.innerHTML = '<p style="text-align:center;">‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>';
            }
        }

        function renderProducts(products) {
            const grid = document.getElementById('gallery-grid');
            if (products.length === 0) {
                grid.innerHTML = '<p style="text-align:center;">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§</p>';
                return;
            }

            let html = '';
            products.forEach(p => {
                html += `
                    <div class="product-card" onclick="viewProduct('${p.id}')">
                        <div class="card-img-box">
                            <img src="${p.image}" alt="${p.name}" loading="lazy">
                        </div>
                        <div class="card-info">
                            <h3 class="card-title">${p.name}</h3>
                            <p class="card-price">‡ß≥ ${p.price}</p>
                            <span class="btn-view">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</span>
                        </div>
                    </div>
                `;
            });
            grid.innerHTML = html;
        }

        window.filterProducts = (category) => {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (category === 'all') {
                renderProducts(allProducts);
            } else {
                const filtered = allProducts.filter(p => p.category === category);
                renderProducts(filtered);
            }
        };

        window.viewProduct = (id) => {
            localStorage.setItem('currentProductId', id);
            window.location.href = `product.html?id=${id}`;
        };

        loadProducts();
    </script>
</body>
</html>