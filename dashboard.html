<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</title>
    
    <!-- ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶∂‡¶ø‡¶ü -->
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="modules/admin/dashboard/dashboard.css">
</head>
<body>

    <!-- ‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞‡¶ø‡¶ü‡¶ø ‡¶ö‡ßá‡¶ï‡¶ø‡¶Ç ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ -->
    <div id="auth-check" class="loading-screen">
        <div class="spinner"></div>
        <p>‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>
    
    <!-- ‡¶Æ‡ßá‡¶á‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° -->
    <div class="dashboard-wrapper" id="main-dash" style="display:none;">
        
        <!-- ‡ßß. ‡¶ü‡¶™ ‡¶¨‡¶æ‡¶∞ -->
        <header class="dash-header">
            <div class="header-left">
                <h2>‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
                <!-- ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶≤‡ßã -->
                <p id="admin-page-title">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
            </div>
            <div class="header-right">
                <a href="index.html" class="btn-view-site" target="_blank">üåç ‡¶∏‡¶æ‡¶á‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</a>
                <button id="logout-btn" class="btn-logout">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
        </header>

        <!-- ‡ß®. ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü -->
        <div class="dashboard-container">
            <div class="welcome-banner">
                <h1>‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, ‡¶ï‡ßá‡¶∂‡¶¨ ‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞ üëã</h1>
                <p>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <p>Today's Sales</p>
                    <h2 id="stat-today-sales">‚Çπ 0</h2>
                </div>
                <div class="stat-card">
                    <p>Total Orders</p>
                    <h2 id="stat-total-orders">0</h2>
                </div>
                <div class="stat-card alert-card" id="low-stock-alert" style="display:none;">
                    <p>‚ö†Ô∏è Low Stock Items</p>
                    <h2 id="stat-low-stock">0</h2>
                </div>
            </div>

            <div class="dashboard-grid">
                
                <!-- ‡ßß. ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ -->
                <a href="settings.html" class="dash-card card-settings">
                    <div class="icon-box">‚öôÔ∏è</div>
                    <div class="card-info">
                        <h3>‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
                        <p>‡¶®‡¶æ‡¶Æ, ‡¶≤‡ßã‡¶ó‡ßã, ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶ì ‡¶∏‡ßã‡¶∂‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï</p>
                    </div>
                </a>

                <!-- ‡ß®. ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü -->
                <a href="manage-product.html" class="dash-card card-product">
                    <div class="icon-box">üëó</div>
                    <div class="card-info">
                        <h3>‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞</h3>
                        <p>‡¶®‡¶§‡ßÅ‡¶® ‡¶∂‡¶æ‡¶°‡¶º‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶°, ‡¶è‡¶°‡¶ø‡¶ü ‡¶ì ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</p>
                    </div>
                </a>

                <!-- ‡ß©. ‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú -->
                <a href="manage-home.html" class="dash-card card-home">
                    <div class="icon-box">üè†</div>
                    <div class="card-info">
                        <h3>‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú ‡¶è‡¶°‡¶ø‡¶ü</h3>
                        <p>‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞, ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶ì ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</p>
                    </div>
                </a>

                <!-- ‡ß™. ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ -->
                <a href="orders.html" class="dash-card card-order">
                    <div class="icon-box">üì¶</div>
                    <div class="card-info">
                        <h3>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</h3>
                        <p>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ì ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï</p>
                    </div>
                </a>

                <!-- ‡ß´. ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞ -->
                <a href="https://dashboard.tawk.to/#/chat" target="_blank" class="dash-card card-chat">
                    <div class="icon-box">üí¨</div>
                    <div class="card-info">
                        <h3>Live Chat Inbox</h3>
                        <p>Click here to reply to customers</p>
                    </div>
                </a>

                <!-- ‡ß¨. ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü -->
                <a href="manage-admins.html" class="dash-card card-admin">
                    <div class="icon-box">üë•</div>
                    <div class="card-info">
                        <h3>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h3>
                        <p>‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ì ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    </div>
                </a>

                <!-- ‡ß≠. ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ -->
                <a href="manage-customers.html" class="dash-card card-customers">
                    <div class="icon-box">üìä</div>
                    <div class="card-info">
                        <h3>Customer Database</h3>
                        <p>View all customer information</p>
                    </div>
                </a>

            </div>
        </div>
    </div>

    <!-- ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶á‡¶®‡¶¨‡¶ï‡ßç‡¶∏ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ -->
    <div id="admin-chat-panel" class="admin-chat-panel">
        <div class="chat-panel-header">
            <h3>üí¨ Live Chat Inbox</h3>
            <button onclick="toggleChatPanel()" class="btn-close-chat">‚úñ</button>
        </div>
        <iframe id="chat-inbox-frame" src="https://tawk.to/chat/6965d60db5ffaf19820cc735/1jeqso9s7" frameborder="0"></iframe>
    </div>

    <!-- ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü -->
    <script type="module">
        import { auth, logoutUser } from './config/firebase-config.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { isAdmin } from './utils/auth-helper.js';
        import { db } from './config/firebase-config.js';
        import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        async function loadDashboardStats() {
            const orderSnap = await getDocs(collection(db, "orders"));
            let totalOrders = 0;
            let todaySales = 0;
            const today = new Date().toLocaleDateString();

            orderSnap.forEach(doc => {
                const data = doc.data();
                totalOrders++;
                const orderDate = new Date(data.orderDate.seconds * 1000).toLocaleDateString();
                if(orderDate === today && data.status !== 'cancelled') {
                    todaySales += Number(data.totalPrice || 0);
                }
            });

            document.getElementById('stat-total-orders').innerText = totalOrders;
            document.getElementById('stat-today-sales').innerText = `‚Çπ ${todaySales}`;

            const productSnap = await getDocs(collection(db, "products"));
            let lowStockCount = 0;
            productSnap.forEach(doc => {
                if(doc.data().qty <= 5) lowStockCount++;
            });

            if(lowStockCount > 0) {
                document.getElementById('low-stock-alert').style.display = 'block';
                document.getElementById('stat-low-stock').innerText = lowStockCount;
            }
        }

        onAuthStateChanged(auth, async (user) => {
            if (user && await isAdmin(user.email)) {
                document.getElementById('auth-check').style.display = 'none';
                document.getElementById('main-dash').style.display = 'block';
                loadDashboardStats();
            } else {
                window.location.href = 'admin.html';
            }
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
                logoutUser();
                window.location.href = 'index.html';
            }
        });

        // ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ü‡¶ó‡¶≤ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.toggleChatPanel = () => {
            const panel = document.getElementById('admin-chat-panel');
            panel.classList.toggle('active');
        };
    </script>

    <!-- ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ -->
    <script type="module" src="./utils/global-loader.js"></script>
</body>
</html>