<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Database | SootBoot Admin</title>
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/main.css">
    <style>
        body { background-color: #f4f7f6; font-family: 'Hind Siliguri', sans-serif; }
        
        /* ‡¶π‡ßá‡¶°‡¶æ‡¶∞ */
        .top-bar {
            background: white; padding: 15px 4%; display: flex;
            justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100;
        }
        .top-bar h2 { color: var(--primary-color); margin: 0; font-size: 1.5rem; }
        .btn-back { text-decoration: none; color: #666; border: 1px solid #ddd; padding: 8px 20px; border-radius: 50px; transition: 0.3s; font-weight: 600; }
        .btn-back:hover { background: #eee; }

        /* ‡¶Æ‡ßá‡¶á‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ */
        .content-container { padding: 40px 4%; max-width: 1200px; margin: 0 auto; }

        /* ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° */
        .customer-card {
            background: white; padding: 0; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.03); overflow: hidden;
            border: 1px solid #eee;
        }

        /* ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .customer-table { width: 100%; border-collapse: collapse; text-align: left; }
        .customer-table th { background: #f8f9fa; padding: 20px; color: #555; font-weight: 700; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; }
        .customer-table td { padding: 20px; border-bottom: 1px solid #f0f0f0; vertical-align: middle; }
        .customer-table tr:last-child td { border-bottom: none; }
        .customer-table tr:hover { background: #fffcf5; }

        /* ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶á‡¶®‡¶´‡ßã */
        .c-name { font-weight: 700; color: #333; font-size: 1.1rem; display: block; }
        .c-sub { color: #888; font-size: 0.9rem; margin-top: 3px; }
        
        /* ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú */
        .order-count-badge {
            background: var(--primary-color); color: white;
            padding: 5px 15px; border-radius: 50px; font-weight: bold; font-size: 0.85rem;
        }

        /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ */
        @media (max-width: 768px) {
            .content-container { padding: 20px 10px; }
            .customer-table th:nth-child(2), .customer-table td:nth-child(2) { display: none; } /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤‡ßá ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶¨‡ßá */
            .top-bar h2 { font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <div class="manager-wrapper">
        <div class="top-bar">
            <h2>üë• Customer Database</h2>
            <a href="dashboard.html" class="btn-back">‚¨Ö Dashboard</a>
        </div>

        <div class="content-container">
            <div class="customer-card">
                <table class="customer-table">
                    <thead>
                        <tr>
                            <th>Customer Info</th>
                            <th>Contact Details</th>
                            <th>Activity</th>
                        </tr>
                    </thead>
                    <tbody id="customer-list-body">
                        <tr><td colspan="3" style="text-align:center; padding:50px; color:#888;">Loading customers...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="module">
        import { db } from './config/firebase-config.js';
        import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        async function loadCustomers() {
            try {
                const snap = await getDocs(collection(db, "orders"));
                const customers = {};
                
                snap.forEach(doc => {
                    const d = doc.data();
                    // ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ï‡ßá ‡¶á‡¶â‡¶®‡¶ø‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶õ‡¶ø
                    const key = d.phone || d.userEmail || 'unknown';
                    
                    if(!customers[key]) {
                        customers[key] = { 
                            name: d.customerName || 'Guest User', 
                            email: d.userEmail || 'No Email', 
                            phone: d.phone || 'No Phone',
                            count: 0 
                        };
                    }
                    customers[key].count++;
                });

                const body = document.getElementById('customer-list-body');
                const customerArray = Object.values(customers);

                if (customerArray.length === 0) {
                    body.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:50px;">No customers found.</td></tr>';
                    return;
                }

                body.innerHTML = customerArray.map(c => `
                    <tr>
                        <td>
                            <span class="c-name">${c.name}</span>
                            <span class="c-sub">Customer ID: #${Math.random().toString(36).substr(2, 6).toUpperCase()}</span>
                        </td>
                        <td>
                            <div style="color:#333; font-weight:500;">üìû ${c.phone}</div>
                            <div style="color:#777; font-size:0.85rem;">‚úâÔ∏è ${c.email}</div>
                        </td>
                        <td>
                            <span class="order-count-badge">${c.count} Orders</span>
                        </td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error(e);
                document.getElementById('customer-list-body').innerHTML = '<tr><td colspan="3" style="color:red; text-align:center;">Error loading data.</td></tr>';
            }
        }
        loadCustomers();
    </script>
</body>
</html>